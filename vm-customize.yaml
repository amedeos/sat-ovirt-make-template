- name: Template Customization
  hosts: localhost
  become: false
  gather_facts: false
  vars_files:
    - variables-vault.yaml
    - variables.yaml
  tasks:
  - name: Add vm host
    add_host:
      name: "{{ engine_template.name }}"
      #ansible_ssh_private_key_file: ansible-ssh/id_rsa
      ansible_ssh_user: root
      ansible_password: "{{ vm_password }}"
      ansible_ssh_host: "{{ template.ip }}"
      groups:
        - templaterhv
    changed_when: False

- name: Wait for the vm to be online
  hosts: templaterhv
  gather_facts: True
  vars_files:
    - variables-vault.yaml
    - variables.yaml
  tasks:

  - name: Write motd
    copy:
      dest: /etc/motd
      content: |
        Generated by Ansible
      owner: root
      group: root
      mode: '0644'
